/* =========================================
   NEUROQUIZ‚Ñ¢ - FINAL INTERACTIVE UI (V16)
   File: css/quiz.css
   ========================================= */

/* 1. THEME VARIABLES SETUP */
:root {
    /* --- CORE GAME COLORS --- */
    --game-red: #ff4b4b;    --game-red-shadow: #c50000;
    --game-blue: #1cb0f6;   --game-blue-shadow: #118cc6;
    --game-yellow: #ffc800; --game-yellow-shadow: #cc8e00;
    --game-green: #2bde73;  --game-green-shadow: #1ba653;

    /* --- LIGHT MODE DEFAULTS --- */
    --page-bg-color: #4487de;            /* Vibrant Blue */
    
    --quiz-bg-color: #ffffff;            
    --quiz-text-primary: #2c2c2c;        
    --quiz-text-secondary: #4b5563;      
    --quiz-border: rgba(0,0,0,0.1);      
    --quiz-shadow: rgba(0,0,0,0.1);      
    --progress-track: #e5e5e5;           
    --brand-color: #1e293b;

    /* Button Themes (Light) */
    --submit-btn-bg: #2c2c2c;            
    --submit-btn-text: #ffffff;
}

/* --- DARK MODE OVERRIDES --- */
:root[data-theme="dark"] {
    --page-bg-color: #2e0249;            /* Deep Purple */
    
    --quiz-bg-color: #1a1a2e;            
    --quiz-text-primary: #ffffff;        
    --quiz-text-secondary: #a78bfa;      
    --quiz-border: rgba(255,255,255,0.1);
    --quiz-shadow: rgba(0,0,0,0.5);      
    --progress-track: rgba(255,255,255,0.1);
    --brand-color: #ffffff;

    --hint-btn-bg: rgba(255,255,255,0.05);
    --hint-btn-text: #cccccc;
    --hint-btn-border: rgba(255,255,255,0.2);
    --submit-btn-bg: #ffffff;            
    --submit-btn-text: #2e0249;
}

/* 2. PAGE BACKGROUND (Interactive) */
body {
    background-color: var(--page-bg-color) !important;
    background-image: none !important; 
    font-family: 'Nunito', 'Segoe UI', sans-serif;
    min-height: 100vh;
    transition: background-color 0.3s ease;
    overflow-x: hidden;
}

/* Canvas Styling */
#neural-bg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1; pointer-events: none;
}

/* Dino Animation Container */
.dino-animation-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 80px;
    z-index: 50;
    pointer-events: none;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 20px;
    max-width: 400px;
    margin: 0 auto;
}

/* Responsive Dino Animation */
@media (max-width: 600px) {
    .dino-animation-container {
        max-width: 100%;
        height: 60px;
        padding: 0 10px;
    }
}

@media (max-width: 480px) {
    .dino-animation-container {
        height: 50px;
    }
}

.dino-animation-container .mid-header-animation {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
}

/* 3. MAIN CARD */
.quiz-container {
    background: var(--quiz-bg-color);
    border-radius: 30px;
    padding: 2.5rem;
    max-width: 850px;
    width: 100%;
    
    /* Professional spacing: dino animation (80px) + comfortable gap (60px) = 140px */
    margin: 140px auto 100px auto;
    
    border: 4px solid var(--quiz-border);
    box-shadow: 0 20px 0 var(--quiz-shadow);
    position: relative;
    overflow: visible;
    z-index: 10;
}

/* Responsive Quiz Container */
@media (max-width: 768px) {
    .quiz-container {
        padding: var(--spacing-lg);
        margin: var(--spacing-xl) auto var(--spacing-lg);
        border-radius: 20px;
    }
}

@media (max-width: 480px) {
    .quiz-container {
        padding: var(--spacing-md);
        margin: var(--spacing-lg) auto var(--spacing-md);
        border-radius: 15px;
        border-width: 2px;
    }
}

/* THE QUESTION CARD (no tilt ‚Äî transform forced to none) */
#question-card {
    background: rgba(255, 255, 255, 0.5); 
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transform: none !important;
    position: relative;
    overflow: hidden; 
}

/* Responsive Question Card */
@media (max-width: 768px) {
    #question-card {
        padding: var(--spacing-lg);
    }
}

@media (max-width: 480px) {
    #question-card {
        padding: var(--spacing-md);
        border-radius: 15px;
    }
}

[data-theme="dark"] #question-card {
    background: rgba(30, 30, 50, 0.6);
    border-color: rgba(255, 255, 255, 0.1);
}

.card-glare {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 20px; pointer-events: none; mix-blend-mode: overlay; z-index: 2;
}

/* 4. USER WELCOME SECTION */
.user-welcome-section {
    margin-bottom: 1.5rem;
    padding: 0 5px 15px 5px;
    animation: slideInRight 0.5s ease-out;
    border-bottom: 2px solid var(--quiz-border);
    display: flex; align-items: center; justify-content: space-between;
}

.greeting-text {
    font-size: clamp(0.75rem, 2.5vw, 0.85rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--quiz-text-secondary);
    opacity: 0.8;
}

.user-name {
    font-size: clamp(1.25rem, 4vw, 1.8rem);
    font-weight: 900;
    background: linear-gradient(90deg, var(--game-blue), #8b5cf6);
    
    /* FIX: Define standard property first, then WebKit */
    background-clip: text;
    -webkit-background-clip: text;
    
    -webkit-text-fill-color: transparent;
    display: inline-block;
}

[data-theme="dark"] .user-name {
    background: linear-gradient(90deg, #60a5fa, #c084fc);
    
    /* FIX: Added here as well for safety */
    background-clip: text;
    -webkit-background-clip: text;
    
    -webkit-text-fill-color: transparent;
}

.cognitive-status {
    font-size: clamp(0.7rem, 2vw, 0.75rem);
    font-weight: 800;
    color: var(--quiz-text-secondary);
    background: var(--progress-track);
    padding: 6px 14px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
/* --------------------------------------------------------- */

/* 4. PROGRESS BAR (Water Glass Effect) */
.progress-section { margin-bottom: 2rem; }

.progress-bar-wrapper {
    /* Glass Container Look */
    background: rgba(255, 255, 255, 0.2); 
    backdrop-filter: blur(4px);
    height: 28px; /* Slightly thicker for the glass effect */
    border-radius: 50px;
    border: 3px solid rgba(255, 255, 255, 0.8); /* Thick Glass Border */
    box-shadow: 
        inset 0 4px 6px rgba(0,0,0,0.1), /* Inner depth */
        0 10px 20px rgba(0,0,0,0.05); /* Outer shadow */
    position: relative;
    overflow: hidden;
    z-index: 1;
}

/* Dark Mode Glass Adjustment */
:root[data-theme="dark"] .progress-bar-wrapper {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
}

.progress-bar {
    width: 100%;
    height: 100%;
}

.progress-fill {
    display: block; 
    /* Water Gradient (Deep Blue to Cyan) */
    background: linear-gradient(90deg, #0061ff 0%, #60efff 100%);
    height: 100%; 
    border-radius: 50px; 
    width: 0%;
    /* Bouncy "Slosh" Transition */
    transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    box-shadow: 0 0 15px rgba(96, 239, 255, 0.6); /* Glow */
}

/* The "Glare" Reflection on top of the water */
.progress-fill::after {
    content: '';
    position: absolute;
    top: 4px; left: 10px; right: 10px; height: 35%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.7), rgba(255,255,255,0.1));
    border-radius: 20px;
}

/* Bubbles Effect (Optional decoration) */
.progress-fill::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-image: 
        radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px),
        radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px);
    background-size: 10px 10px, 20px 20px;
    background-position: 0 0, 10px 10px;
    opacity: 0.3;
}

.progress-text {
    display: flex; justify-content: space-between; margin-top: 10px;
    font-weight: 800; color: var(--quiz-text-secondary);
    text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px;
}

/* Motivational Message */
.motivation-message {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1rem;
    padding: 0.875rem 1.25rem;
    background: rgba(28, 176, 246, 0.1);
    border: 2px solid rgba(28, 176, 246, 0.3);
    border-radius: 12px;
    backdrop-filter: blur(8px);
    animation: slideInUp 0.4s ease-out;
    box-shadow: 0 4px 12px rgba(28, 176, 246, 0.15);
    transition: all 0.3s ease;
}

.motivation-message:hover {
    border-color: rgba(28, 176, 246, 0.5);
    box-shadow: 0 6px 16px rgba(28, 176, 246, 0.25);
    transform: translateY(-2px);
}

.motivation-message[style*="display: none"] {
    display: none !important;
}

.motivation-icon {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    color: var(--game-blue);
    display: flex;
    align-items: center;
    justify-content: center;
}

.motivation-icon svg {
    width: 100%;
    height: 100%;
}

.motivation-text {
    flex: 1;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--quiz-text-primary);
    line-height: 1.4;
}

[data-theme="dark"] .motivation-message {
    background: rgba(96, 165, 250, 0.15);
    border-color: rgba(96, 165, 250, 0.3);
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Screen reader only text */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* 5. QUESTION AREA */
.question-badge {
    background: #ce82ff; color: #fff; padding: 6px 16px;
    border-radius: 20px; font-weight: 900; font-size: 0.9rem;
    display: inline-block; margin-bottom: 1rem;
    box-shadow: 0 4px 0 #a14add; transform: translateZ(20px); 
}

.question-title {
    color: var(--quiz-text-primary);
    font-size: clamp(1.125rem, 4vw, 2rem);
    font-weight: 900;
    line-height: 1.5;
    margin-bottom: 2.5rem;
    text-align: center;
    transition: color 0.3s ease;
    transform: translateZ(30px);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

@media (max-width: 480px) {
    .question-title {
        margin-bottom: var(--spacing-lg);
        line-height: 1.4;
    }
}

/* 7. OPTIONS GRID */
.options-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    transform: translateZ(20px);
}

@media (min-width: 600px) {
    .options-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }
}

.option-btn {
    border: none;
    border-radius: 16px;
    padding: 1.25rem 1.5rem;
    font-size: clamp(0.95rem, 3vw, 1.2rem);
    font-weight: 800;
    color: #2c2c2c !important;
    cursor: pointer;
    position: relative;
    text-align: left;
    display: flex;
    align-items: center;
    min-height: 88px; /* Large hitbox ‚Äî easy to tap */
    min-width: 100%;
    width: 100%;
    transition: transform 0.1s !important, outline 0.2s ease, box-shadow 0.2s ease;
    box-shadow: 0 6px 0 rgba(0,0,0,0.2);
    z-index: 1;
    outline: 2px solid transparent;
    outline-offset: 3px; /* Slightly larger focus area */
}

/* Tablet */
@media (max-width: 768px) {
    .option-btn {
        min-height: 84px;
        padding: 1.125rem 1.25rem;
    }
}

/* Mobile: even larger hitbox for touch */
@media (max-width: 480px) {
    .options-container {
        gap: 18px; /* More space between options for easier targeting */
    }
    .option-btn {
        min-height: 80px;
        padding: 1.25rem 1rem;
        font-size: clamp(1rem, 4vw, 1.125rem);
        outline-offset: 4px;
    }
}

.option-btn:focus-visible {
    outline: 3px solid var(--game-blue);
    outline-offset: 2px;
    box-shadow: 0 6px 0 rgba(0,0,0,0.2), 0 0 0 4px rgba(28, 176, 246, 0.3);
}

.option-btn[aria-checked="true"] {
    outline: 3px solid var(--game-blue);
    outline-offset: 2px;
}

.option-btn::before {
    position: static !important; content: '' !important; display: inline-block !important;
    width: 40px !important; height: 40px !important; margin-right: 15px !important;
    background: rgba(0,0,0,0.2) !important; border-radius: 8px !important;
}

/* Option Colors */
.option-btn[data-option-id="0"] { background: var(--game-red) !important; box-shadow: 0 6px 0 var(--game-red-shadow); }
.option-btn[data-option-id="1"] { background: var(--game-blue) !important; box-shadow: 0 6px 0 var(--game-blue-shadow); }
.option-btn[data-option-id="2"] { background: var(--game-yellow) !important; box-shadow: 0 6px 0 var(--game-yellow-shadow); }
.option-btn[data-option-id="3"] { background: var(--game-green) !important; box-shadow: 0 6px 0 var(--game-green-shadow); }

/* FIX: Added !important to content so icons appear */
.option-btn[data-option-id="0"]::before { content: '‚ñ≤' !important; font-size: 24px; text-align: center; line-height: 40px; }
.option-btn[data-option-id="1"]::before { content: '‚óÜ' !important; font-size: 24px; text-align: center; line-height: 40px; }
.option-btn[data-option-id="2"]::before { content: '‚óè' !important; font-size: 24px; text-align: center; line-height: 40px; }
.option-btn[data-option-id="3"]::before { content: '‚ñ†' !important; font-size: 24px; text-align: center; line-height: 35px; }

/* HOVER STATE: White Outline */
.option-btn:hover:not(:disabled) {
    transform: translateY(-4px) translateZ(10px); 
    filter: brightness(1.1); 
    /* White outline + shadow */
    box-shadow: 0 10px 0 rgba(0,0,0,0.1), 0 0 0 4px #ffffff !important; 
    z-index: 10;
}

/* ACTIVE / SELECTED STATE: White Outline + Glow */
.option-btn:active:not(:disabled), .option-btn.selected {
    transform: translateY(2px) translateZ(0px); 
    filter: brightness(1.2) contrast(1.1);
    border: none; 
}

/* Selected States with White Outline + Color Glow */
.option-btn[data-option-id="0"].selected { 
    box-shadow: 0 0 0 4px #ffffff, 0 0 20px var(--game-red), inset 0 0 20px rgba(255,255,255,0.4) !important; 
}
.option-btn[data-option-id="1"].selected { 
    box-shadow: 0 0 0 4px #ffffff, 0 0 20px var(--game-blue), inset 0 0 20px rgba(255,255,255,0.4) !important; 
}
.option-btn[data-option-id="2"].selected { 
    box-shadow: 0 0 0 4px #ffffff, 0 0 20px var(--game-yellow), inset 0 0 20px rgba(255,255,255,0.4) !important; 
}
.option-btn[data-option-id="3"].selected { 
    box-shadow: 0 0 0 4px #ffffff, 0 0 20px var(--game-green), inset 0 0 20px rgba(255,255,255,0.4) !important; 
}

.option-label { display: none !important; }

/* =========================================
   FEEDBACK AREA
   ========================================= */

.question-section {
    position: relative; display: flex; flex-direction: column; gap: 20px; perspective: 1000px;
}

#feedback-area {
    position: relative; width: 100%; margin-top: 10px; z-index: 100; display: none; 
}

#feedback-area:not(:empty) {
    display: block; animation: slideUpFade 0.4s ease-out forwards;
}

.feedback-card {
    width: 100%; background: var(--quiz-bg-color); border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); border: 2px solid transparent; overflow: hidden;
}

.feedback-card.correct { border-color: var(--game-green); }
.feedback-card.correct .feedback-header {
    background: var(--game-green); color: #fff; box-shadow: 0 4px 0 var(--game-green-shadow);
}
.feedback-card.correct { animation: rubberBand 0.8s; }

.feedback-card.incorrect { border-color: var(--game-red); }
.feedback-card.incorrect .feedback-header {
    background: var(--game-red); color: #fff; box-shadow: 0 4px 0 var(--game-red-shadow);
}
.feedback-card.incorrect {
    animation: slideUpFade 0.4s ease-out, headShake 0.5s ease-in-out 0.4s;
}

.feedback-header {
    padding: 1rem; display: flex; align-items: center; justify-content: center; gap: 12px;
    font-size: 1.5rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
    text-shadow: 0 2px 0 rgba(0,0,0,0.2); position: relative; z-index: 2;
}

.feedback-icon {
    background: rgba(255,255,255,0.2); width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2rem; box-shadow: inset 0 2px 0 rgba(0,0,0,0.2);
}

.feedback-body {
    padding: 2rem 1.5rem; text-align: center;
    color: var(--quiz-text-primary); font-weight: 700; font-size: 1.1rem; line-height: 1.5;
}

.points-badge {
    display: inline-block; margin-top: 1rem; padding: 8px 20px;
    border-radius: 12px; font-weight: 900; text-transform: uppercase; font-size: 0.9rem;
    background: var(--quiz-border); color: var(--quiz-text-secondary);
}

/* =========================================
   8. ACTION BUTTONS 
   ========================================= */

.quiz-actions {
    margin-top: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    border-top: 2px dashed var(--quiz-border);
    padding-top: 2rem;
    width: 100%;
    box-sizing: border-box;
    transform: translateZ(20px);
    position: relative;
    flex-wrap: wrap;
}

/* Responsive Quiz Actions */
@media (max-width: 480px) {
    .quiz-actions {
        gap: var(--spacing-sm);
        padding-top: var(--spacing-lg);
        flex-direction: column;
        align-items: stretch;
    }
    
    .btn-stop {
        align-self: center; /* Below submit, centred */
    }
}

/* HINT BUTTON */
#hint-btn {
    flex: 0 0 auto; min-width: 60px; height: 60px; padding: 0;
    background: var(--hint-btn-bg); border: 2px solid var(--hint-btn-border);
    color: var(--hint-btn-text); box-shadow: 0 4px 0 var(--quiz-border);
    display: flex; align-items: center; justify-content: center; border-radius: 16px;
    font-size: 1.5rem; transition: all 0.2s ease; position: relative;
}
#hint-btn:hover {
    border-color: #fbbf24; background: #fffbeb; color: #d97706; 
    box-shadow: 0 0 15px rgba(251, 191, 36, 0.5), 0 6px 0 var(--quiz-border);
    transform: translateY(-2px); 
}
#hint-btn:active {
    background: #fbbf24; border-color: #f59e0b; color: #ffffff;
    box-shadow: 0 0 20px #fbbf24, inset 0 0 10px rgba(255, 255, 255, 1);
    transform: translateY(4px); 
}

/* SUBMIT & NEXT BUTTONS */
.action-center { flex: 1; display: flex; justify-content: center; }

#submit-btn, #next-btn {
    width: 100%; height: 60px; padding: 0 2rem; 
    font-size: 1.2rem; font-weight: 800; border-radius: 16px;
    text-transform: uppercase;
    background: var(--submit-btn-bg); color: var(--submit-btn-text);
    box-shadow: 0 6px 0 rgba(0,0,0,0.3); border: none; cursor: pointer;
    transition: transform 0.1s, filter 0.2s;
    display: flex; align-items: center; justify-content: center;
}
#submit-btn:hover:not(:disabled), #next-btn:hover {
    filter: brightness(1.2); transform: translateY(-2px);
}

#submit-btn:focus-visible, #next-btn:focus-visible {
    outline: 3px solid var(--game-blue);
    outline-offset: 2px;
    box-shadow: 0 6px 0 rgba(0,0,0,0.3), 0 0 0 4px rgba(28, 176, 246, 0.3);
}

#submit-btn:active, #next-btn:active {
    transform: translateY(4px); box-shadow: none !important;
}
#submit-btn:disabled {
    opacity: 0.5; cursor: not-allowed; transform: none !important; 
    box-shadow: none !important; filter: grayscale(1);
}

/* STOP BUTTON ‚Äî icon + "Stop Quiz" so purpose is clear */
.btn-stop {
    flex: 0 0 auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 140px;
    min-height: 52px;
    height: 52px;
    padding: 0 1.25rem;
    background: rgba(255, 59, 48, 0.12);
    border: 2px solid rgba(255, 59, 48, 0.5);
    box-shadow: 0 4px 0 rgba(180, 40, 35, 0.4);
    color: #dc2626;
    border-radius: 14px;
    font-size: 0.95rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    z-index: 10;
    white-space: nowrap;
}
.btn-stop-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.btn-stop-icon svg {
    width: 18px;
    height: 18px;
}
.btn-stop-text {
    font-family: inherit;
}

[data-theme="dark"] .btn-stop {
    background: rgba(255, 59, 48, 0.18);
    border-color: rgba(255, 59, 48, 0.6);
    color: #f87171;
    box-shadow: 0 4px 0 rgba(120, 30, 28, 0.5);
}
.btn-stop:hover {
    border-color: #dc2626;
    background: rgba(255, 59, 48, 0.2);
    color: #b91c1c;
    box-shadow: 0 0 14px rgba(255, 59, 48, 0.35), 0 6px 0 rgba(180, 40, 35, 0.4);
    transform: translateY(-2px);
}
[data-theme="dark"] .btn-stop:hover {
    background: rgba(255, 59, 48, 0.28);
    color: #fca5a5;
}
.btn-stop:active {
    background: #dc2626;
    border-color: #b91c1c;
    color: #fff;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.25);
    transform: translateY(3px);
}
.btn-stop:focus-visible {
    outline: 3px solid #dc2626;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.3);
}

/* Stop button: tablet */
@media (max-width: 768px) {
    .btn-stop {
        min-width: 130px;
        min-height: 50px;
        height: 50px;
        padding: 0 1rem;
        font-size: 0.875rem;
    }
    .btn-stop-icon svg { width: 17px; height: 17px; }
}

/* Stop button: phone */
@media (max-width: 480px) {
    .btn-stop {
        min-width: 120px;
        min-height: 48px;
        height: 48px;
        padding: 0 0.875rem;
        font-size: 0.8125rem;
    }
    .btn-stop-icon svg { width: 16px; height: 16px; }
}

@media (max-width: 600px) {
    /* Adjust spacing on mobile for better visual balance */
    .quiz-container {
        margin-top: 120px;
        padding: 1.5rem;
    }
    
    .motivation-message {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }
    
    .motivation-icon {
        width: 18px;
        height: 18px;
    }
    
    .quiz-actions { 
        gap: 10px; 
        flex-direction: column;
        align-items: stretch;
    }
    .btn-stop { 
        width: auto;
        min-width: 120px;
        min-height: 50px;
        height: 50px;
        padding: 0 1rem;
        font-size: 0.875rem;
        border-radius: 12px;
        align-self: center; /* Below submit, centred */
    }
    .action-center {
        max-width: 100%;
    }
    #submit-btn, #next-btn { 
        height: 50px; 
        font-size: 0.9rem; 
        border-radius: 12px; 
    }
}

/* =========================================
   9. GAMIFICATION HEADER
   ========================================= */

.gamification-header {
    background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border-radius: 20px; padding: 15px 30px; margin-bottom: 2rem;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 1);
    position: relative; overflow: hidden; transition: all 0.3s ease;
}

.header-stats-inner {
    flex: 1;
    min-width: 0;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}

[data-theme="dark"] .gamification-header {
    background: linear-gradient(145deg, rgba(30, 30, 50, 0.9), rgba(15, 15, 25, 0.8));
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.gamification-header::after {
    content: ''; position: absolute; top: 0; left: 0; width: 60px; height: 100%;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.6), transparent);
    transform: skewX(-20deg); animation: headerShimmer 6s infinite linear; pointer-events: none;
}
[data-theme="dark"] .gamification-header::after {
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.1), transparent);
}
@keyframes headerShimmer { 0% { left: -100px; } 20% { left: 120%; } 100% { left: 120%; } }

.header-stat {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    flex: 1; position: relative; z-index: 2; 
}
.stat-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    color: #ea580c;
    filter: drop-shadow(0 0 8px rgba(234, 88, 12, 0.4));
    animation: simpleBounce 2s infinite ease-in-out;
}
[data-theme="dark"] .stat-icon {
    color: #facc15;
    filter: drop-shadow(0 0 10px rgba(250, 204, 21, 0.5));
}
.stat-icon svg {
    stroke-width: 2.25;
    flex-shrink: 0;
}
.stat-label {
    font-family: inherit; font-weight: 800; text-transform: uppercase;
    font-size: 0.75rem; letter-spacing: 1px; color: #64748b; margin-bottom: 4px;
}
[data-theme="dark"] .stat-label { color: #94a3b8; }
.stat-value {
    font-size: 1.5rem; font-weight: 900; line-height: 1;
    color: #1e293b; text-shadow: 0 1px 0 rgba(255,255,255,0.5);
}
[data-theme="dark"] .stat-value { color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

@keyframes simpleBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }

/* =========================================
   10. HEADER & NAV (Centered Layout Fix)
   ========================================= */

.header {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 80px; z-index: 1000;
    padding: 0 30px; display: flex; align-items: center;
    pointer-events: none; box-sizing: border-box;
}

.nav { width: 100%; display: flex; align-items: center; }

.nav-container {
    width: 100%; max-width: none; margin: 0;
    display: flex; align-items: center; justify-content: space-between;
    pointer-events: auto;
}

/* LOGO: Fixed width to balance the Nav */
.logo-container {
    flex: 0 0 280px; /* Forces Left side to match Right side width */
    display: flex; align-items: center; gap: 15px; text-decoration: none;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); transition: transform 0.2s ease;
}
.logo-container:hover { transform: scale(1.05); }
.logo { height: 45px; width: auto; }

/* Navbar typography should match layout.css - removed override */
/* Brand name typography is now handled in layout.css for consistency */
.brand-name {
    /* Typography inherited from layout.css:
       font-family: 'Orbitron', 'Segoe UI', sans-serif;
       font-size: 1.75rem;
       font-weight: 800;
       letter-spacing: 3px;
       text-transform: uppercase;
    */
    color: var(--text-primary);
    white-space: nowrap;
}

/* NAV MENU: Fixed width to balance the Logo */
.nav-menu {
    flex: 0 0 280px; /* Forces Right side to match Left side width */
    justify-content: flex-end; /* Keeps text aligned to the right inside the box */
    
    position: relative; list-style: none; margin: 0; padding: 5px;
    display: flex; align-items: center; gap: 5px;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    border-radius: 50px; margin-right: 0;
}
[data-theme="dark"] .nav-menu {
    background: rgba(15, 23, 42, 0.6); border-color: rgba(255, 255, 255, 0.1);
}

.nav-marker {
    position: absolute; left: 5px; top: 5px; height: calc(100% - 10px);
    border-radius: 40px; z-index: 1;
    background: var(--game-blue); 
    box-shadow: 0 4px 12px rgba(28, 176, 246, 0.4);
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    width: 0; opacity: 0; 
}
[data-theme="dark"] .nav-marker { background: #4c1d95; }

/* Navbar typography should match layout.css - removed override */
.nav-link {
    /* Typography inherited from layout.css:
       font-family: 'Orbitron', 'Segoe UI', sans-serif;
       font-size: 0.95rem;
       font-weight: 600;
       letter-spacing: 0.5px;
       text-transform: uppercase;
    */
    position: relative; 
    z-index: 2; 
    display: block;
    text-decoration: none; 
    padding: 10px 24px;
    border-radius: 40px; 
    transition: color 0.2s ease; 
    white-space: nowrap;
    color: #64748b !important; 
    background: transparent !important; 
    box-shadow: none !important;
}
.nav-link:hover, .nav-link.active { color: #ffffff !important; }
.nav-menu:hover .nav-link.active:not(:hover) { color: #64748b !important; }
[data-theme="dark"] .nav-link { color: #94a3b8 !important; }
[data-theme="dark"] .nav-link:hover, [data-theme="dark"] .nav-link.active { color: #ffffff !important; }
[data-theme="dark"] .nav-menu:hover .nav-link.active:not(:hover) { color: #94a3b8 !important; }

/* Mobile Reset: Remove fixed widths on small screens so they don't break layout */
@media (max-width: 900px) {
    .logo-container, .nav-menu {
        flex: 0 0 auto;
    }
}

/* =========================================
   12. DINO RUNNER: ADAPTIVE THEME (EXACT CODE)
   ========================================= */

.mid-header-animation {
    height: 70px; position: relative; overflow: hidden;
    background: linear-gradient(to bottom, #bae6fd 0%, #f0f9ff 100%);
    border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

.dino-animation-container .mid-header-animation {
    width: 100%;
    max-width: 1200px;
}

.dino-sky { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.cloud {
    position: absolute; background: #ffffff; border-radius: 20px; opacity: 0.9;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05); animation: sceneryScroll linear infinite;
}
.cloud-1 { width: 50px; height: 14px; top: 15px; left: 100%; animation-duration: 15s; }
.cloud-2 { width: 30px; height: 10px; top: 30px; left: 100%; animation-duration: 20s; animation-delay: 5s; }

.star {
    position: absolute; width: 2px; height: 2px; background: #fff; border-radius: 50%;
    animation: twinkle 3s infinite alternate; opacity: 0; 
}
.star-1 { top: 10px; left: 20%; }
.star-2 { top: 20px; left: 60%; animation-duration: 2s; }

.dino-ground {
    position: absolute; bottom: 0; left: 0; width: 200%; height: 10px;
    background: repeating-linear-gradient(90deg, transparent 0, transparent 195px, rgba(0,0,0,0.1) 195px, rgba(0,0,0,0.1) 200px);
    border-top: 1px solid rgba(0,0,0,0.1); animation: groundScroll 3s linear infinite;
}

.obstacle-cactus {
    position: absolute; bottom: 10px; left: 100%; width: 16px; height: 24px;
    background: #22c55e; 
    clip-path: polygon(30% 0, 70% 0, 70% 100%, 30% 100%, 30% 60%, 0% 50%, 0% 30%, 30% 40%, 70% 40%, 100% 30%, 100% 50%, 70% 60%);
    filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); animation: cactusMove 6s linear infinite;
}

.obstacle-bird {
    position: absolute; bottom: 35px; left: 100%; width: 24px; height: 16px; background: #e11d48;
    clip-path: polygon(0 40%, 30% 40%, 60% 60%, 100% 30%, 80% 60%, 40% 70%, 20% 60%);
    filter: drop-shadow(0 4px 3px rgba(0,0,0,0.2)); animation: birdMove 6s linear infinite;
}
.bird-wing {
    position: absolute; top: -5px; left: 5px; width: 10px; height: 10px; background: #e11d48;
    clip-path: polygon(0 100%, 50% 0, 100% 100%); animation: wingFlap 0.3s infinite alternate;
}

.dino-rex {
    position: absolute; bottom: 10px; left: 40px; width: 44px; height: 44px; z-index: 10;
    animation: dinoJumpLoop 6s ease-in-out infinite;
}
.rex-body-wrapper {
    width: 100%; height: 100%; transform-origin: bottom center; animation: dinoDuckLoop 6s ease-in-out infinite;
}
.rex-shape {
    width: 100%; height: 100%; background: #334155; 
    clip-path: polygon(50% 0, 100% 0, 100% 35%, 65% 35%, 65% 45%, 90% 45%, 90% 55%, 50% 55%, 50% 65%, 20% 50%, 0 55%, 20% 80%, 20% 100%, 55% 100%, 55% 80%);
}
.rex-eye { position: absolute; top: 5px; right: 12px; width: 3px; height: 3px; background: #fff; }
.rex-arm { position: absolute; top: 25px; right: 14px; width: 4px; height: 2px; background: #fff; }
.rex-leg { position: absolute; bottom: -4px; width: 6px; height: 10px; background: #334155; }
.leg-left  { left: 22px; animation: runLegs 0.2s infinite alternate; }
.leg-right { left: 32px; animation: runLegs 0.2s infinite alternate-reverse; }

/* Dark Mode Dino */
[data-theme="dark"] .mid-header-animation {
    background: linear-gradient(to bottom, #020617 0%, #1e293b 100%);
    border-color: rgba(255,255,255,0.15); box-shadow: inset 0 0 30px rgba(0,0,0,0.6);
}
[data-theme="dark"] .star { opacity: 1; }
[data-theme="dark"] .cloud { background: rgba(255, 255, 255, 0.05); box-shadow: none; }
[data-theme="dark"] .dino-ground {
    background: repeating-linear-gradient(90deg, transparent 0, transparent 195px, rgba(255,255,255,0.3) 195px, rgba(255,255,255,0.3) 200px);
    border-top-color: rgba(255,255,255,0.2);
}
[data-theme="dark"] .obstacle-cactus { background: #2bde73; box-shadow: 0 0 10px #2bde73; filter: none; }
[data-theme="dark"] .obstacle-bird, [data-theme="dark"] .bird-wing { background: #f43f5e; filter: drop-shadow(0 0 5px #f43f5e); }
[data-theme="dark"] .rex-shape, [data-theme="dark"] .rex-leg { background: #cbd5e1; filter: drop-shadow(0 0 5px rgba(255,255,255,0.4)); }
[data-theme="dark"] .rex-eye, [data-theme="dark"] .rex-arm { background: #0f172a; }

/* Animation Keyframes */
@keyframes cactusMove { 0% { left: 100%; } 21.67% { left: 40px; } 35% { left: -20%; } 100% { left: -20%; } }
@keyframes dinoJumpLoop { 0%, 8% { transform: translateY(0); } 21.67% { transform: translateY(-55px); } 28% { transform: translateY(0); } 100% { transform: translateY(0); } }
@keyframes birdMove { 0%, 50% { left: 100%; } 71.67% { left: 40px; } 85% { left: -20%; } 100% { left: -20%; } }
@keyframes dinoDuckLoop { 0%, 55% { transform: scale(1, 1); } 71.67% { transform: scale(1.3, 0.5) translateY(15px); } 78% { transform: scale(1, 1); } 100% { transform: scale(1, 1); } }
@keyframes sceneryScroll { 0% { left: 100%; } 100% { left: -20%; } }
@keyframes groundScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
@keyframes twinkle { 0% { opacity: 0.3; } 100% { opacity: 1; } }
@keyframes wingFlap { 0% { transform: scaleY(1); } 100% { transform: scaleY(-1); } }
@keyframes runLegs { 0% { height: 10px; transform: translateY(0); } 100% { height: 6px; transform: translateY(-4px); } }

/* Optimize animations for mobile */
@media (max-width: 768px) {
    #neural-bg,
    #background-shapes {
        opacity: 0.5; /* Reduce visibility for better performance */
    }
}

@media (max-width: 480px) {
    #neural-bg,
    #background-shapes {
        display: none; /* Hide completely on very small screens */
    }
    
    .option-btn:hover:not(:disabled) {
        transform: scale(1.02); /* Smaller scale on mobile */
    }
}

@media (max-width: 1100px) { 
    .dino-animation-container { display: none; }
    /* When dino is hidden, reduce top margin for better spacing */
    .quiz-container {
        margin-top: 60px;
    }
}

/* =========================================
   PAGE TRANSITIONS & EFFECTS
   ========================================= */

.anim-exit { animation: slideOutLeft 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards; pointer-events: none; }
.anim-enter { animation: slideInRight 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
.anim-feedback-exit { animation: dropFadeOut 0.3s ease-in forwards; }
.btn-enter { animation: btnPopIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

@keyframes slideOutLeft { 0% { opacity: 1; transform: translateX(0) scale(1); } 100% { opacity: 0; transform: translateX(-50px) scale(0.95); } }
@keyframes slideInRight { 0% { opacity: 0; transform: translateX(50px) scale(0.95); } 100% { opacity: 1; transform: translateX(0) scale(1); } }
@keyframes dropFadeOut { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(20px); } }
@keyframes btnPopIn { 0% { opacity: 0; transform: translateY(10px) scale(0.9); } 100% { opacity: 1; transform: translateY(0) scale(1); } }

.hidden { display: none !important; }

/* =========================================
   CUSTOM MODAL / POPUP STYLES
   ========================================= */

.custom-modal-overlay {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); z-index: 10000;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
.custom-modal-overlay.active { opacity: 1; pointer-events: auto; }

.custom-modal-card {
    background: var(--quiz-bg-color); 
    width: 90%; 
    max-width: 400px; 
    border-radius: 24px; 
    padding: 2rem;
    text-align: center; 
    border: 2px solid var(--quiz-border); 
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    transform: scale(0.9) translateY(20px); 
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    z-index: 10001;
    pointer-events: auto;
}
.custom-modal-overlay.active .custom-modal-card { transform: scale(1) translateY(0); }

.modal-header { margin-bottom: 1rem; }
.modal-icon { font-size: 3rem; display: block; margin-bottom: 0.5rem; animation: floatIcon 3s ease-in-out infinite; }
.modal-title { font-size: 1.5rem; font-weight: 900; color: var(--quiz-text-primary); margin: 0; text-transform: uppercase; }

.modal-body p {
    color: var(--quiz-text-primary); /* Ensures White Text in Dark Mode */
    font-size: 1.1rem; font-weight: 600; line-height: 1.5; margin-bottom: 2rem;
}

.modal-footer { 
    display: flex; 
    gap: 10px; 
    justify-content: center; 
    position: relative;
    z-index: 1;
}

.btn-modal {
    border: none; 
    padding: 12px 24px; 
    border-radius: 12px; 
    font-weight: 800; 
    font-size: 1rem;
    cursor: pointer; 
    transition: transform 0.2s, filter 0.2s; 
    flex: 1 1 auto;
    min-width: 0;
    position: relative;
    z-index: 10;
    pointer-events: auto;
    user-select: none;
    -webkit-user-select: none;
}
.btn-modal:hover { transform: translateY(-2px); }
.btn-modal:active { transform: translateY(0); }

.btn-modal-primary { background: var(--game-blue); color: white; box-shadow: 0 4px 0 var(--game-blue-shadow); }
.btn-modal-danger { background: var(--game-red); color: white; box-shadow: 0 4px 0 var(--game-red-shadow); }
.btn-modal-secondary { background: var(--quiz-border); color: var(--quiz-text-secondary); }

@keyframes floatIcon { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

/* =========================================
   NEW: COLORFUL FLOATING BACKGROUND SHAPES
   ========================================= */

#background-shapes {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 0; pointer-events: none; overflow: hidden;
}

.bg-shape {
    position: absolute; border-radius: 50%;
    backdrop-filter: blur(2px); mix-blend-mode: multiply; 
    animation: shapeFloat ease-in-out forwards;
}

[data-theme="dark"] .bg-shape { mix-blend-mode: screen; filter: brightness(1.2); }

@keyframes shapeFloat {
    0% { opacity: 0; transform: scale(0.5) translateY(50px) rotate(0deg); }
    30% { opacity: 0.6; } 70% { opacity: 0.6; }
    100% { opacity: 0; transform: scale(1.2) translateY(-100px) rotate(45deg); }
}

/* =========================================
   DYNAMIC ICON EFFECTS (VFX)
   ========================================= */

/* Base Icon Styling (Perfect Alignment) */
.stat-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    font-size: 1.8rem;
    transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    border-radius: 50%;
    z-index: 5;
}

/* --- 1. LEVEL EFFECTS (Star ‚≠ê) --- */
/* Tier 1: Normal ‚Äî bright gold, soft glow */
.fx-level-1 {
    color: #f59e0b !important;
    filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.8)) drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    transform: scale(1);
}
[data-theme="dark"] .fx-level-1 { color: #fbbf24 !important; filter: drop-shadow(0 0 12px rgba(251, 191, 36, 0.9)); }

/* Tier 2: Gold Glow */
.fx-level-2 { 
    color: #fbbf24 !important;
    filter: drop-shadow(0 0 10px #fbbf24) drop-shadow(0 0 20px rgba(251, 191, 36, 0.5)); 
    transform: scale(1.1); 
    animation: breatheGold 3s infinite ease-in-out;
}

/* Tier 3: Intense Pulse */
.fx-level-3 { 
    color: #f59e0b !important;
    filter: drop-shadow(0 0 14px #f59e0b) drop-shadow(0 0 28px rgba(245, 158, 11, 0.6)) brightness(1.15); 
    transform: scale(1.25);
    animation: starSpin 5s infinite linear; 
}
.fx-level-3::after {
    content: '‚ú®';
    position: absolute;
    top: -10px; right: -10px;
    font-size: 1rem;
    animation: sparkleBlink 0.8s infinite alternate;
}

/* Tier 4: Cosmic Spin (High Level) */
.fx-level-4 { 
    color: #e879f9 !important;
    filter: drop-shadow(0 0 18px #e879f9) drop-shadow(0 0 30px rgba(217, 70, 239, 0.5)) brightness(1.1);
    animation: spinSlow 4s infinite linear; 
}

/* --- 2. STREAK EFFECTS (Fire üî•) --- */
/* Tier 1: No Streak ‚Äî visible orange, no grayscale */
.fx-streak-0 {
    opacity: 0.95;
    color: #fb923c !important;
    filter: drop-shadow(0 0 8px rgba(251, 146, 60, 0.6));
    transform: scale(1);
}
[data-theme="dark"] .fx-streak-0 { color: #fdba74 !important; filter: drop-shadow(0 0 10px rgba(253, 186, 116, 0.7)); }

/* Tier 2: Lit (Orange) */
.fx-streak-1 { 
    opacity: 1;
    color: #f97316 !important;
    filter: drop-shadow(0 0 10px #f97316) drop-shadow(0 0 18px rgba(249, 115, 22, 0.5)); 
    transform: scale(1); 
}

/* Tier 3: Blazing (Red + Shake) */
.fx-streak-2 { 
    color: #ef4444 !important;
    filter: drop-shadow(0 0 14px #ef4444) drop-shadow(0 0 24px rgba(239, 68, 68, 0.6)) brightness(1.2); 
    transform: scale(1.15);
    animation: flicker 0.1s infinite alternate;
}

/* Tier 4: Blue Plasma (Hottest Fire) */
.fx-streak-3 { 
    color: #38bdf8 !important;
    filter: drop-shadow(0 0 18px #38bdf8) drop-shadow(0 0 30px rgba(56, 189, 248, 0.5)) brightness(1.15);
    transform: scale(1.2);
    animation: pulseBlue 1s infinite alternate; 
}

/* --- 3. POINTS EFFECTS (Diamond üíé) --- */
/* Tier 1: Normal ‚Äî bright cyan, soft glow */
.fx-points-1 {
    color: #06b6d4 !important;
    filter: drop-shadow(0 0 10px rgba(6, 182, 212, 0.7)) drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}
[data-theme="dark"] .fx-points-1 { color: #22d3ee !important; filter: drop-shadow(0 0 12px rgba(34, 211, 238, 0.8)); }

/* Tier 2: Cyan Shine */
.fx-points-2 { 
    color: #06b6d4 !important;
    filter: drop-shadow(0 0 12px #06b6d4) drop-shadow(0 0 22px rgba(6, 182, 212, 0.5)); 
    transform: scale(1.1); 
}

/* Tier 3: Purple Radiance */
.fx-points-3 { 
    color: #a855f7 !important;
    filter: drop-shadow(0 0 14px #a855f7) drop-shadow(0 0 26px rgba(168, 85, 247, 0.5)); 
    transform: scale(1.15); 
}

/* Tier 4: Rainbow Prismatic */
.fx-points-4 { 
    color: #ec4899 !important;
    filter: drop-shadow(0 0 18px #ec4899) drop-shadow(0 0 30px rgba(236, 72, 153, 0.5)); 
    animation: rainbowShift 3s infinite linear; 
    transform: scale(1.2);
}

/* --- ANIMATIONS --- */
@keyframes breatheGold { 0%, 100% { transform: scale(1.1); } 50% { transform: scale(1.15); } }
@keyframes pulseBlue { 0% { transform: scale(1.2); } 100% { transform: scale(1.35); } }
@keyframes spinSlow { 0% { transform: rotate(0deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1.2); } }
@keyframes flicker { 0% { opacity: 0.9; transform: scale(1.15) rotate(-2deg); } 100% { opacity: 1; transform: scale(1.15) rotate(2deg); } }
@keyframes rainbowShift { 0% { filter: hue-rotate(0deg) drop-shadow(0 0 10px white); } 100% { filter: hue-rotate(360deg) drop-shadow(0 0 10px white); } }
@keyframes starSpin { 0% { transform: rotate(0deg) scale(1.25); } 100% { transform: rotate(360deg) scale(1.25); } }
@keyframes sparkleBlink { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1.2); } }

/* =========================================
   NEW: 3-STATE THEME TOGGLE (SLIDER)
   ========================================= */

/* The Floating Container */
.theme-segmented-control {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
    
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.6); /* Glass background */
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50px;
    padding: 4px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

/* Dark Mode Container Background */
:root[data-theme="dark"] .theme-segmented-control {
    background: rgba(15, 23, 42, 0.6);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}

/* Hide the actual radio buttons */
.theme-input {
    display: none;
}

/* The Clickable Labels (Icons) */
.theme-label {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    z-index: 2; /* Sit on top of slider */
    color: var(--quiz-text-secondary);
    transition: color 0.3s ease;
}

.theme-label svg {
    width: 20px;
    height: 20px;
    stroke-width: 2.5;
}

/* Hover Effect */
.theme-label:hover {
    color: var(--game-blue);
}

/* --- THE SLIDING PILL (BACKGROUND) --- */
.theme-slider {
    position: absolute;
    top: 4px;
    left: 4px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy spring effect */
    z-index: 1;
}

:root[data-theme="dark"] .theme-slider {
    background: #334155; /* Dark grey for dark mode */
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

/* --- SLIDING LOGIC & COLORS --- */

/* Position 1: System (Default) - No transform */
#theme-system:checked ~ .theme-slider {
    transform: translateX(0);
}
#theme-system:checked + .theme-label {
    color: var(--game-blue);
}

/* Position 2: Light Mode - Slide Middle */
#theme-light:checked ~ .theme-slider {
    transform: translateX(40px); /* Move 1 icon width to right */
}
#theme-light:checked + .theme-label {
    color: #f59e0b; /* Sun Yellow */
}

/* Position 3: Dark Mode - Slide Right */
#theme-dark:checked ~ .theme-slider {
    transform: translateX(80px); /* Move 2 icon widths to right */
}
/* White-Greyish Moon Icon Color */
#theme-dark:checked + .theme-label {
    color: #e2e8f0; 
}

/* Quiz: hide theme toggle on phone/tablet ‚Äî desktop only (fixed bottom-right) */
@media (max-width: 768px) {
    .theme-segmented-control {
        display: none !important;
    }
}